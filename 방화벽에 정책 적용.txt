1. **ë°©í™”ë²½ì— ì •ì±… ì ìš©**

â€» iptables ëŒ€ì‹  nftables(NetFilter tables)ë¥¼ ì´ìš©í•˜ì—¬ ë°©í™”ë²½ êµ¬ì¶• (firewalld, firewall-cmdë¥¼ ì´ìš©)

ğŸ’¡ ë§¤ìŠ¤ì»¤ë ˆì´ë”©ì„ í†µí•œ ì¸í„°ë„· ê³µìœ  ê¸°ëŠ¥. 192.168.111.100 ì„ ì¸í„°ë„· ì—°ê²°, 10.1.1.x ë¥¼ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì—°ê²°ë¡œ í™œìš©.
   ì´ë•Œ 10.1.1.x IPì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ëŠ” ì»´í“¨í„°ì—ì„œëŠ” 10.1.1.20(LoadBalancerì˜ IP ì£¼ì†Œ)ë¥¼ í†µí•´ ì™¸ë¶€ì— ì ‘ì†í•˜ê²Œ ë¨


## 1. firewalld ì˜ ê° zone, source ì— ens160, ens224 ê´€ë ¨ ì„¤ì •

```bash
sudo firewall-cmd --permanent --zone=internal --add-source=10.1.1.0/24
sudo firewall-cmd --permanent --zone=internal --add-interface=ens224
sudo firewall-cmd --permanent --zone=public --add-interface=ens160
```

## 2. direct ì˜µì…˜ìœ¼ë¡œ ens224, ens160 ê°„ì˜ FORWARD ì •ì˜ (-i: input, -s: source, -d: destination, -m: match, -j, jump)

```bash
sudo firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -i ens224 -s 10.1.1.0/24 -d 0.0.0.0/0 -m state --state NEW,ESTABLISHED -j ACCEPT
sudo firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 1 -i ens160 -d 10.1.1.0/24 -m state --state ESTABLISHED -j ACCEPT
```

## 3. ens160(public) ì€ ì™¸ë¶€ ì—°ê²° ë° ë§¤ìŠ¤ì»¤ë ˆì´ë”© í™œì„±í™”

```bash
sudo firewall-cmd --permanent --zone=public --add-masquerade
```

## 4. ens224(internal) ì€ ë‚´ë¶€ì™€ ens160 ê°„ì˜ ì—°ê²°ì„ ìœ„í•´ set-targetì„ í†µí•´ ì˜ì—­í•œ í¬ì›Œë”© í—ˆìš©

```bash
sudo firewall-cmd --permanent --zone=internal --set-target=ACCEPT
```

## 5. firewalld ë‹¤ì‹œ ì ìš© ë° ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë‹¤ì‹œ í™œì„±í™”

```bash
sudo firewall-cmd --reload && nmcli con up ens160 && nmcli con up ens224
```

ğŸ’¡ 192.168.111.100:80 ì ‘ì†ì„ 10.1.1.20:80 ì ‘ì†ìœ¼ë¡œ í¬ì›Œë”© í•˜ê¸°

## 6. 10.1.1.20 ì„œë²„ì—ì„œ httpd ì„¤ì¹˜ ë° ë°©í™”ë²½ì˜ httpd service í—ˆìš© ë˜ëŠ” 80/tcp í—ˆìš©

```bash
sudo dnf -y install httpd
systemctl start httpd
systemctl enable httpd
vi /var/www/html/index.html     // í…ŒìŠ¤íŠ¸ í™”ë©´ ë§Œë“¤ê¸° ex) "This is Linux"

sudo firewall-cmd --permanent --zone=public --add-port=80/tcp
sudo firewall-cmd --reload
```

## 7. ê²Œì´íŠ¸ì›¨ì´/ë°©í™”ë²½ì—ì„œ public, internal ì— í¬íŠ¸ í—ˆìš© ëª…ë ¹ ì‹¤í–‰

```bash
sudo firewall-cmd --permanent --zone=public --add-port=80/tcp
sudo firewall-cmd --permanent --zone=internal --add-port=80/tcp
sudo firewall-cmd --reload
```

## 8. ê²Œì´íŠ¸ì›¨ì´/ë°©í™”ë²½ì—ì„œ í¬ì›Œë”© ì„¤ì •

```bash
# ì™¸ë¶€ì—ì„œ firewallì˜ 80ë²ˆ í¬íŠ¸ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  TCP íŠ¸ë˜í”½ì„ 10.1.1.20 ì£¼ì†Œì˜ 80ë²ˆ í¬íŠ¸ë¡œ ì „ë‹¬í•˜ë„ë¡ ì„¤ì •
sudo firewall-cmd --permanent --add-forward-port=port=80:proto=tcp:toaddr=10.1.1.20:toport=80
```

## 9. ê²Œì´íŠ¸ì›¨ì´/ë°©í™”ë²½ì—ì„œ direct ì˜µì…˜ìœ¼ë¡œ ì„¤ì •

- ì•„ë˜ FORWARD ë’¤ì˜ ìˆ«ìëŠ” ìš°ì„ ìˆœìœ„ë¡œì¨ ì´ì „ ì„¤ì •ëœ 0, 1ì— ì´ì–´ 2, 3ì„ ì§€ì •

```bash
sudo firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 2 -d 10.1.1.20 -p tcp --dport 80 -j ACCEPT
sudo firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 3 -s 10.1.1.0/24 -d 192.168.111.100 -p tcp --dport 80 -j ACCEPT
sudo firewall-cmd --permanent --direct --add-rule ipv4 nat PREROUTING 0 -d 192.168.111.100 -p tcp --dport 80 -j DNAT --to-destination 10.1.1.20:80
sudo firewall-cmd --reload
```

## tcpdump ëª…ë ¹ìœ¼ë¡œ ê²Œì´íŠ¸ì›¨ì´/ë°©í™”ë²½ì—ì„œ íŒ¨í‚· ìš”ì²­ í™•ì¸

- ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ê³  í˜¸ìŠ¤íŠ¸OS ë“±ì—ì„œ 192.168.111.100 ìœ¼ë¡œ ì ‘ì†í•˜ë©´ ë¡œê·¸ê°€ ì¶œë ¥ë¨

```bash
sudo tcpdump -i ens160 tcp port 80 and dst host 192.168.111.100
```

- http://192.168.111.100/ ì ‘ì†í•´ë³´ê¸°